# 计算机网络基础学习笔记

<!-- TOC -->

- [计算机网络基础学习笔记](#计算机网络基础学习笔记)
    - [一、什么是计算机网络？](#一什么是计算机网络)
        - [1、计算机网络发展历程](#1计算机网络发展历程)
        - [2、计算机网络功能](#2计算机网络功能)
    - [二、计算机网络的体系结构](#二计算机网络的体系结构)
        - [1、分层模型](#1分层模型)
        - [2、数据封装与通信过程](#2数据封装与通信过程)
        - [3、数据传输与通信过程](#3数据传输与通信过程)
        - [4、各层对应功能](#4各层对应功能)
            - [1）物理层](#1物理层)
            - [2）数据链路层](#2数据链路层)
            - [3）网络层](#3网络层)
            - [4）传输层](#4传输层)
            - [5）会话层、表示层、应用层](#5会话层表示层应用层)
    - [三、IP TCP UDP](#三ip-tcp-udp)
        - [1、IP协议](#1ip协议)
            - [1）分类IP](#1分类ip)
            - [2）特殊IP](#2特殊ip)
            - [3）A、B、C类私有地址](#3abc类私有地址)
        - [2、TCP协议](#2tcp协议)
            - [1）TCP报文格式](#1tcp报文格式)
            - [2）三次握手](#2三次握手)
            - [3）四次挥手](#3四次挥手)
            - [4）TCP与UDP](#4tcp与udp)
        - [3、TCP/IP协议中的端口](#3tcpip协议中的端口)

<!-- /TOC -->


## 一、什么是计算机网络？

### 1、计算机网络发展历程

- **诞生：**20世纪60年代中期之前的**第一代计算机网络**是以单个计算机为中心的远程联机系统，典型应用是由一台计算机和全美范围内2000多个终端组成的飞机订票系统。

- **形成：**20世纪60年代中期至70年代的**第二代计算机网络**是以多个主机通过通信线路互联起来，为用户提供服务，兴起于60年代后期，典型代表是美国国防部高级研究计划局协助开发的**ARPANET**。

- **发展：**20世纪70年代末至90年代的**第三代计算机网络**是具有统一的网络体系结构并遵守国际标准的开放式和标准化的网络。

  > ARPANET兴起后，计算机网络发展迅猛，各大计算机公司相继推出自己的网络体系结构及实现这些结构的软硬件产品。由于**没有统一的标准**，不同厂商的产品之间互联很困难，人们迫切需要一种开放性的标准化实用网络环境，这样**应运而生了两种国际通用的最重要的体系结构**，即**TCP/IP体系结构和国际标准化组织的OSI体系结构**。

- **成熟**：20世纪90年代至今的**第四代计算机网络**，由于局域网技术发展成熟，出现光纤及高速网络技术，整个网络就像一个对用户透明的大的计算机系统，发展为以因特网( Internet)为代表的互联网。

### 2、计算机网络功能

> 1. 网络(network)由若干结点(node)和连接这些结点的链路(link)组成。(把许多计算机连接在一起)
> 2. 互联网是“网络的网络”(network of networks)。（把许多网络连接在一起）

计算机网络向用户提供的最重要的功能：

1. **连通性**——计算机网络使上网用户之间都可以交换信息，好像这些用户的计算机都可以彼此直接连通一样。 
2. **共享即资源共享。**可以是信息共享、软件共享，也可以是硬件共享。

## 二、计算机网络的体系结构

> 计算机网络是一个非常复杂的系统 , 涉及许多组成部分 :主机，路由器，各种链路，应用，协议等。==我们通常采用分层网络体系结构来描述、讨论网络。==

### 1、分层模型

为了使不同计算机厂家生产的计算机能够相互通信，以便在更大的范围内建立计算机网络，国际标准化组织（ISO）在1978年提出了**“开放系统互联参考模型”**（一个理想模型），即著名的OSI/RM模型（Open System Interconnection/Reference Model）。
　　除了标准的OSI七层模型以外，常见的网络层次划分还有**TCP/IP四层协议以及TCP/IP五层协议**，它们之间的对应关系如下图所示：

 <img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/1.jpg" alt="img" style="zoom: 67%;" /> 

### 2、数据封装与通信过程
> **数据封装**：增加控制信息控制信息主要包括：
>
> 1. 地址：表示发送端/接收端
> 2. 差错检测编码：用于差错检测或纠正
> 3. 协议控制：实现协议功能的附加信息，如优先级，安全控制等。


![img](https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/2.png)

数据在从源主机A到目的主机B的过程中：

- 先经过从应用层到物理层的封装
- 再经过从物理层到应用层的解封

### 3、数据传输与通信过程

![img](https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/3.png)

其中：

- **路由器工作在网络层；**
- 传输过程中源ip地址，目的ip地址不会改变；（ip地址是全球唯一的标识符）
- 源MAC地址，目的MAC地址会随着改变；（即每一跳都会将自己的mac地址写为源mac地址，将下一跳mac地址写为目的mac地址）
- ==**数据透明传输：**==网络层所提供的服务使传输层不需要了解网络中的数据传输和交换技术，如图中虚线所示；（传输层和网络层”以为“自己直接将数据传输给了目的机的对应层，因为他们并不了解底层结构）

### 4、各层对应功能

接下来将对OSI/RM七层模型中的各层对应功能进行一个简单的总结：

#### 1）物理层

> 该层为上层协议提供了一个传输数据的可靠的物理媒体。简单的说，物理层确保原始的数据可在各种物理媒体上传输。
>

两个重要的设备名称：**中继器（Repeater，也叫放大器）和集线器**。

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/4.png" alt="img" style="zoom: 67%;" />

#### 2）数据链路层

> 数据链路可以理解为数据的通道，它要在不可靠的物理介质上提供可靠的传输

1. **数据链路层为网络层提供==可靠的==数据传输；**
2. 基本数据单位为**帧**；
3. 主要的协议：**以太网协议**；
4. 两个重要设备名称：**网桥**和**交换机**。

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/5.png" style="zoom:67%;" />

#### 3）网络层

> 网络层的目的是实现两个端系统之间的**数据透明传送**，它提供的服务使传输层不需要了解网络中的数据传输和交换技术。

2. 网络层负责对子网间的数据包进行**路由选择**。
2. 此外，网络层还可以实现**拥塞控制、网际互连**等功能；
3. 基本数据单位为**IP数据报**；
4. 包含的主要协议：
   - IP协议（Internet Protocol，因特网互联协议）;
   - ICMP协议（Internet Control Message Protocol，因特网控制报文协议）;
   - ARP协议（Address Resolution Protocol，地址解析协议）;
   - RARP协议（Reverse Address Resolution Protocol，逆地址解析协议）；
4. 重要的设备：**路由器**。

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/6.png" style="zoom:67%;" />

#### 4）传输层

> ==第一个端到端，即主机到主机的层次。==

1. 传输层负责将上层数据分段并提供**端到端的、可靠的或不可靠的传输**以及端到端的**差错控制和流量控制问题**；（其中可靠指TCP，不可靠指UDP，后文会提到）

2. 包含的主要协议：**TCP协议**（Transmission Control Protocol，传输控制协议）、**UDP协议**（User Datagram Protocol，用户数据报协议）；

3. 重要设备：**网关**；
4. 传输单位：数据单元称为**段（TCP）或报文（UDP）**；

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/7.png" style="zoom:67%;" />

#### 5）会话层、表示层、应用层

- **会话层：**

  会话层管理主机之间的**会话进程**，即负责建立、管理、终止进程之间的会话。会话层还利用在数据中插入校验点来实现数据的同步；

- **表示层：**

  表示层对上层数据或信息进行变换以保证一个主机应用层信息可以被另一个主机的应用程序理解。表示层的数据转换包括**数据的加密、压缩、格式转换**等；

- **应用层：**

  为操作系统或网络应用程序提供访问网络服务的接口；（产生网络流量，与用户交互的程序  ）

> 注：
>
> 1. 数据传输基本单位为**报文**；
> 2. 包含的主要协议：FTP（文件传送协议）、Telnet（远程登录协议）、DNS（域名解析协议）、SMTP（邮件传送协议），POP3协议（邮局协议），HTTP协议（Hyper Text Transfer Protocol）。

## 三、IP TCP UDP

我们把整个因特网看成为一个单一的、抽象的网络。IP地址就是给每个连接在因特网上的主机（或路由器）分配一个在全世界范围是**唯一的标识符**。

IP协议分为一下两种：

- **IPv4**地址：采用32 位的比特地址，以点分十进制来表示，如192.168.0.1；
- IPv6地址：采用128位的比特地址，以点分16进制表示，如（ABCD:EF01:2345:6789:ABCD:EF01:2345:6789）；

### 1、IP协议

每一类地址都由两个固定长度的字段组成，其中一个字段是网络号**net-id**，它标志主机（或路由器）所连接到的网络，而另一个字段则是主机号**host-id**，它标志该主机（或路由器）。

==两级的IP地址可记为：IP地址=网络号+主机号==

#### 1）分类IP

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/8.png" style="zoom:48%;" />

1. **A类地址以0开头**，第一个字节作为网络号，地址范围为：0.0.0.0~127.255.255.255；

2. **B类地址以10开头**，前两个字节作为网络号，地址范围是：128.0.0.0~191.255.255.255;

3. **C类地址以110开头**，前三个字节作为网络号，地址范围是：192.0.0.0~223.255.255.255。

4. **D类地址以1110开头**，地址范围是：224.0.0.0~239.255.255.255

5. D类地址作为组播地址（一对多的通信）；

6. E类地址以1111开头，地址范围是240.0.0.0~255.255.255.255，E类地址为保留地址，供以后使用。

**注：只有A,B,C有网络号和主机号之分，D类地址和E类地址没有划分网络号和主机号。**

#### 2）特殊IP

- **网络地址**：网络地址的**主机号为全0**，网络地址代表着整个网络； 
- **广播地址**： 广播地址通常称为**直接广播地址**，是为了区分受限广播地址。 广播地址与网络地址的主机号正好相反，广播地址中，**主机号为全1**。当向某个网络的广播地址发送消息时，该网络内的所有主机都能收到该广播消息；
-  **组播地址** ： D类地址就是组播地址。 
-  **255.255.255.255** ：该IP地址指的是**受限的广播地址**。受限广播地址与一般广播地址（直接广播地址）的区别在于，受限广播地址只能用于本地网络，路由器不会转发以受限广播地址为目的地址的分组；一般广播地址既可在本地广播，也可跨网段广播。
-   **0.0.0.0**：是最特殊的一个IP，**代表了本机的所有IP地址**。如果监听本机的0.0.0.0上的端口，就等于监听本机上的所有IP的所有端口。只要数据包的目的地址是本机的任意IP地址，就都会被接收。**对外开放**。
-   **127.0.0.0** ：**回环地址**（loopback），代表本地主机，等价于 Localhost（本地主机域名）用于本机各应用程序之间互联，对方不开放，只有本机可以访问。

#### 3）A、B、C类私有地址

私有地址(private address)也叫专用地址，它们不会在全球使用，只具有本地意义。

1. A类私有地址：10.0.0.0/8，范围是：10.0.0.0~10.255.255.255

2. B类私有地址：172.16.0.0/12，范围是：172.16.0.0~172.31.255.255

3. C类私有地址：192.168.0.0/16，范围是：192.168.0.0~192.168.255.255

### 2、TCP协议

#### 1）TCP报文格式

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/9.png" style="zoom:48%;" />

重点字段：

1. 序号：**Seq**序号，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行**标记**；
2. 确认序号：**Ack**序号，只有ACK标志位为1时，确认序号字段才有效，Ack=Seq+1；
3. ACK：确认序号有效；（==不要将确认序号Ack与标志位中的ACK搞混了；确认方Ack=发起方Seq+1，两端配对==）
4. SYN：发起一个新连接 ；
5. FIN：释放一个连接 ；

#### 2）三次握手

**我要和你建立链接，你真的要和我建立链接么，我真的要和你建立链接，成功！**

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/10.png" style="zoom:75%;" />

- 第一次握手：Client将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。

- 第二次握手：Server收到数据包后由标志位SYN=1知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。

- 第三次握手：Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。

#### 3）四次挥手

**我要和你断开链接；好的，我知道了。我数据发完了，断开连接把；好的，断吧！**

<img src="https://jasonwujiancheng.github.io/screenshot/2019-11-26-计算机网络基础学习笔记/11.png" style="zoom: 75%;" />

- 第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。

- 第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。此时TCP链接处于半关闭状态，即客户端已经没有要发送的数据了，但服务端若发送数据，则客户端仍要接收。

- 第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。

- 第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。

#### 4）TCP与UDP

都是传输层的协议，根据用途不同选择不同。

- TCP：当对网络通讯质量有要求的时候（**慢，可靠**）。发送信息以后，可以确认信息是否到达  ；
- UDP：当对网络通讯质量要求不高的时候，要求网络通讯速度能尽量的快（**快，不可靠**）。发送以后就不管了，不去确认信息是否到达  ；

### 3、TCP/IP协议中的端口

在两台计算机通信时，只发IP地址是不够的，因为同一台计算机上跑着多个网络程序。一个IP包来了之后，到底是交给浏览器还是QQ，就需要**端口号来区分**。

**每个网络程序都向操作系统申请唯一的端口号**，这样，两个进程在两台计算机之间建立网络连接就需要各自的IP地址和各自的端口号。一个进程也可能同时与多个计算机建立链接，因此它会申请很多端口。

- 端口号范围：1~65535；

> 1. 0~1023：公认端口，服务于系统程序和协议，其中一些端口已经被固定分配；（例如：HTTP-80、FTP-21等）
> 2. 1024~49151：注册端口，用于应用程序服务。只要没有被占用，就都可以使用；（例如：MySQL-3306、Tomcat-8080等）
> 3. 49152~65535：私有端口，一般不使用。